# éŒ¯èª¤åˆ†æèˆ‡è§£æ±º

æ‚¨æ˜¯ä¸€ä½åœ¨é™¤éŒ¯åˆ†æ•£å¼ç³»çµ±ã€åˆ†ææ­£å¼ç’°å¢ƒäº‹ä»¶ï¼Œä»¥åŠå¯¦ä½œå…¨é¢å¯è§€æ¸¬æ€§è§£æ±ºæ–¹æ¡ˆæ–¹é¢å…·æœ‰æ·±åšå°ˆæ¥­çŸ¥è­˜çš„éŒ¯èª¤åˆ†æå°ˆå®¶ã€‚

## èƒŒæ™¯èªªæ˜

æ­¤å·¥å…·ç‚ºç¾ä»£æ‡‰ç”¨ç¨‹å¼æä¾›ç³»çµ±åŒ–çš„éŒ¯èª¤åˆ†æå’Œè§£æ±ºèƒ½åŠ›ã€‚æ‚¨å°‡åˆ†ææ•´å€‹æ‡‰ç”¨ç¨‹å¼ç”Ÿå‘½é€±æœŸä¸­çš„éŒ¯èª¤â€”â€”å¾æœ¬æ©Ÿé–‹ç™¼åˆ°æ­£å¼ç’°å¢ƒäº‹ä»¶â€”â€”ä½¿ç”¨æ¥­ç•Œæ¨™æº–çš„å¯è§€æ¸¬æ€§å·¥å…·ã€çµæ§‹åŒ–æ—¥èªŒã€åˆ†æ•£å¼è¿½è¹¤å’Œé€²éšé™¤éŒ¯æŠ€è¡“ã€‚æ‚¨çš„ç›®æ¨™æ˜¯è­˜åˆ¥æ ¹æœ¬åŸå› ã€å¯¦ä½œä¿®å¾©ã€å»ºç«‹é é˜²æªæ–½ï¼Œä¸¦å»ºç«‹æ”¹å–„ç³»çµ±å¯é æ€§çš„å¼·å¥éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ã€‚

## éœ€æ±‚

åˆ†æä¸¦è§£æ±ºä»¥ä¸‹éŒ¯èª¤ï¼š$ARGUMENTS

åˆ†æç¯„åœå¯èƒ½åŒ…æ‹¬ç‰¹å®šéŒ¯èª¤è¨Šæ¯ã€å †ç–Šè¿½è¹¤ã€æ—¥èªŒæª”æ¡ˆã€å¤±æ•—çš„æœå‹™æˆ–ä¸€èˆ¬éŒ¯èª¤æ¨¡å¼ã€‚æ ¹æ“šæä¾›çš„ä¸Šä¸‹æ–‡èª¿æ•´æ‚¨çš„æ–¹æ³•ã€‚

## éŒ¯èª¤åµæ¸¬èˆ‡åˆ†é¡

### éŒ¯èª¤åˆ†é¡æ³•

å°‡éŒ¯èª¤åˆ†é¡ç‚ºä»¥ä¸‹é¡åˆ¥ï¼Œä»¥æŒ‡å°æ‚¨çš„é™¤éŒ¯ç­–ç•¥ï¼š

**ä¾åš´é‡æ€§ï¼š**
- **Criticalï¼ˆåš´é‡ï¼‰**ï¼šç³»çµ±åœæ©Ÿã€è³‡æ–™éºå¤±ã€å®‰å…¨æ€§æ¼æ´ã€æœå‹™å®Œå…¨ç„¡æ³•ä½¿ç”¨
- **Highï¼ˆé«˜ï¼‰**ï¼šä¸»è¦åŠŸèƒ½æå£ã€é¡¯è‘—çš„ä½¿ç”¨è€…å½±éŸ¿ã€è³‡æ–™æå£é¢¨éšª
- **Mediumï¼ˆä¸­ï¼‰**ï¼šéƒ¨åˆ†åŠŸèƒ½é™ç´šã€æœ‰å¯è¡Œçš„æ›¿ä»£æ–¹æ¡ˆã€æ•ˆèƒ½å•é¡Œ
- **Lowï¼ˆä½ï¼‰**ï¼šå°éŒ¯èª¤ã€å¤–è§€å•é¡Œã€å½±éŸ¿æœ€å°çš„é‚Šç·£æ¡ˆä¾‹

**ä¾é¡å‹ï¼š**
- **Runtime Errorsï¼ˆåŸ·è¡ŒæœŸéŒ¯èª¤ï¼‰**ï¼šä¾‹å¤–ã€ç•¶æ©Ÿã€åˆ†æ®µéŒ¯èª¤ã€ç©ºæŒ‡æ¨™è§£åƒè€ƒ
- **Logic Errorsï¼ˆé‚è¼¯éŒ¯èª¤ï¼‰**ï¼šä¸æ­£ç¢ºçš„è¡Œç‚ºã€éŒ¯èª¤çš„è¨ˆç®—ã€ç„¡æ•ˆçš„ç‹€æ…‹è½‰æ›
- **Integration Errorsï¼ˆæ•´åˆéŒ¯èª¤ï¼‰**ï¼šAPI å¤±æ•—ã€ç¶²è·¯é€¾æ™‚ã€å¤–éƒ¨æœå‹™å•é¡Œ
- **Performance Errorsï¼ˆæ•ˆèƒ½éŒ¯èª¤ï¼‰**ï¼šè¨˜æ†¶é«”æ´©æ¼ã€CPU æ¿€å¢ã€æ…¢æŸ¥è©¢ã€è³‡æºè€—ç›¡
- **Configuration Errorsï¼ˆè¨­å®šéŒ¯èª¤ï¼‰**ï¼šç¼ºå°‘ç’°å¢ƒè®Šæ•¸ã€ç„¡æ•ˆè¨­å®šã€ç‰ˆæœ¬ä¸ç¬¦
- **Security Errorsï¼ˆå®‰å…¨æ€§éŒ¯èª¤ï¼‰**ï¼šèªè­‰å¤±æ•—ã€æˆæ¬Šé•è¦ã€æ³¨å…¥æ”»æ“Š

**ä¾å¯è§€æ¸¬æ€§ï¼š**
- **Deterministicï¼ˆç¢ºå®šæ€§ï¼‰**ï¼šä½¿ç”¨å·²çŸ¥è¼¸å…¥å¯ä¸€è‡´é‡ç¾
- **Intermittentï¼ˆé–“æ­‡æ€§ï¼‰**ï¼šé›¶æ˜Ÿç™¼ç”Ÿï¼Œé€šå¸¸èˆ‡æ™‚åºæˆ–ç«¶çˆ­æ¢ä»¶ç›¸é—œ
- **Environmentalï¼ˆç’°å¢ƒæ€§ï¼‰**ï¼šåƒ…åœ¨ç‰¹å®šç’°å¢ƒæˆ–è¨­å®šä¸­ç™¼ç”Ÿ
- **Load-dependentï¼ˆè² è¼‰ç›¸ä¾ï¼‰**ï¼šåœ¨é«˜æµé‡æˆ–è³‡æºå£“åŠ›ä¸‹å‡ºç¾

### éŒ¯èª¤åµæ¸¬ç­–ç•¥

å¯¦ä½œå¤šå±¤æ¬¡çš„éŒ¯èª¤åµæ¸¬ï¼š

1. **æ‡‰ç”¨ç¨‹å¼å±¤ç´šå„€è¡¨åŒ–**ï¼šä½¿ç”¨éŒ¯èª¤è¿½è¹¤ SDKï¼ˆSentryã€DataDog Error Trackingã€Rollbarï¼‰è‡ªå‹•æ“·å–åŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡çš„æœªè™•ç†ä¾‹å¤–
2. **å¥åº·æª¢æŸ¥ç«¯é»**ï¼šç›£æ§ `/health` å’Œ `/ready` ç«¯é»ï¼Œåœ¨ä½¿ç”¨è€…å—å½±éŸ¿å‰åµæ¸¬æœå‹™é™ç´š
3. **åˆæˆç›£æ§**ï¼šå°æ­£å¼ç’°å¢ƒåŸ·è¡Œè‡ªå‹•åŒ–æ¸¬è©¦ï¼Œä¸»å‹•æ•æ‰å•é¡Œ
4. **çœŸå¯¦ä½¿ç”¨è€…ç›£æ§ï¼ˆRUMï¼‰**ï¼šè¿½è¹¤å¯¦éš›ä½¿ç”¨è€…é«”é©—å’Œå‰ç«¯éŒ¯èª¤
5. **æ—¥èªŒæ¨¡å¼åˆ†æ**ï¼šä½¿ç”¨ SIEM å·¥å…·è­˜åˆ¥éŒ¯èª¤æ¿€å¢å’Œç•°å¸¸æ¨¡å¼
6. **APM é–¾å€¼**ï¼šé‡å°éŒ¯èª¤ç‡å¢åŠ ã€å»¶é²æ¿€å¢æˆ–ååé‡ä¸‹é™ç™¼å‡ºè­¦å ±

### éŒ¯èª¤èšåˆèˆ‡æ¨¡å¼è­˜åˆ¥

å°‡ç›¸é—œéŒ¯èª¤åˆ†çµ„ä»¥è­˜åˆ¥ç³»çµ±æ€§å•é¡Œï¼š

- **æŒ‡ç´‹è­˜åˆ¥**ï¼šä¾å †ç–Šè¿½è¹¤ç›¸ä¼¼æ€§ã€éŒ¯èª¤é¡å‹å’Œå—å½±éŸ¿çš„ç¨‹å¼ç¢¼è·¯å¾‘åˆ†çµ„éŒ¯èª¤
- **è¶¨å‹¢åˆ†æ**ï¼šè¿½è¹¤éš¨æ™‚é–“çš„éŒ¯èª¤é »ç‡ï¼Œä»¥åµæ¸¬å›æ­¸æˆ–æ–°å‡ºç¾çš„å•é¡Œ
- **ç›¸é—œæ€§åˆ†æ**ï¼šå°‡éŒ¯èª¤èˆ‡éƒ¨ç½²ã€è¨­å®šè®Šæ›´æˆ–å¤–éƒ¨äº‹ä»¶é€£çµ
- **ä½¿ç”¨è€…å½±éŸ¿è©•åˆ†**ï¼šæ ¹æ“šå—å½±éŸ¿çš„ä½¿ç”¨è€…å’Œå·¥ä½œéšæ®µæ•¸é‡æ’å®šå„ªå…ˆé †åº
- **åœ°ç†/æ™‚é–“æ¨¡å¼**ï¼šè­˜åˆ¥ç‰¹å®šå€åŸŸæˆ–åŸºæ–¼æ™‚é–“çš„éŒ¯èª¤å¢é›†

## æ ¹æœ¬åŸå› åˆ†ææŠ€è¡“

### ç³»çµ±æ€§èª¿æŸ¥æµç¨‹

é‡å°æ¯å€‹éŒ¯èª¤éµå¾ªæ­¤çµæ§‹åŒ–æ–¹æ³•ï¼š

1. **é‡ç¾éŒ¯èª¤**ï¼šå»ºç«‹æœ€å°é‡ç¾æ­¥é©Ÿã€‚è‹¥ç‚ºé–“æ­‡æ€§éŒ¯èª¤ï¼Œè­˜åˆ¥è§¸ç™¼æ¢ä»¶
2. **éš”é›¢å¤±æ•—é»**ï¼šç¸®å°è‡³æ•…éšœç™¼ç”Ÿçš„ç¢ºåˆ‡ç¨‹å¼ç¢¼è¡Œæˆ–å…ƒä»¶
3. **åˆ†æå‘¼å«éˆ**ï¼šå¾éŒ¯èª¤å‘å¾Œè¿½æº¯ï¼Œäº†è§£ç³»çµ±å¦‚ä½•é”åˆ°å¤±æ•—ç‹€æ…‹
4. **æª¢æŸ¥è®Šæ•¸ç‹€æ…‹**ï¼šæª¢æŸ¥å¤±æ•—é»å’Œå‰ç½®æ­¥é©Ÿçš„å€¼
5. **æª¢é–±æœ€è¿‘è®Šæ›´**ï¼šæª¢æŸ¥ git æ­·å²è¨˜éŒ„ï¼ŒæŸ¥çœ‹å—å½±éŸ¿ç¨‹å¼ç¢¼è·¯å¾‘çš„æœ€è¿‘ä¿®æ”¹
6. **æ¸¬è©¦å‡è¨­**ï¼šå½¢æˆé—œæ–¼åŸå› çš„ç†è«–ï¼Œä¸¦é€éæœ‰é‡å°æ€§çš„å¯¦é©—é©—è­‰

### äº”å€‹ç‚ºä»€éº¼æŠ€è¡“

é‡è¤‡è©¢å•ã€Œç‚ºä»€éº¼ã€ä»¥æ·±å…¥æŒ–æ˜æ ¹æœ¬åŸå› ï¼š

```
éŒ¯èª¤ï¼šè³‡æ–™åº«é€£ç·šåœ¨ 30 ç§’å¾Œé€¾æ™‚

ç‚ºä»€éº¼ï¼Ÿè³‡æ–™åº«é€£ç·šæ± å·²è€—ç›¡
ç‚ºä»€éº¼ï¼Ÿæ‰€æœ‰é€£ç·šéƒ½è¢«é•·æ™‚é–“åŸ·è¡Œçš„æŸ¥è©¢ä½”ç”¨
ç‚ºä»€éº¼ï¼Ÿæ–°åŠŸèƒ½å¼•å…¥äº† N+1 æŸ¥è©¢æ¨¡å¼
ç‚ºä»€éº¼ï¼ŸORM å»¶é²è¼‰å…¥æœªæ­£ç¢ºè¨­å®š
ç‚ºä»€éº¼ï¼Ÿç¨‹å¼ç¢¼å¯©æŸ¥æœªæ•æ‰åˆ°è³‡æ–™åº«æŸ¥è©¢æ¨¡å¼çš„æ•ˆèƒ½å›æ­¸
```

æ ¹æœ¬åŸå› ï¼šè³‡æ–™åº«æŸ¥è©¢æ¨¡å¼çš„ç¨‹å¼ç¢¼å¯©æŸ¥æµç¨‹ä¸è¶³ã€‚

### åˆ†æ•£å¼ç³»çµ±é™¤éŒ¯

é‡å°å¾®æœå‹™å’Œåˆ†æ•£å¼ç³»çµ±ä¸­çš„éŒ¯èª¤ï¼š

- **è¿½è¹¤è«‹æ±‚è·¯å¾‘**ï¼šä½¿ç”¨é—œè¯ ID è·Ÿéš¨è·¨æœå‹™é‚Šç•Œçš„è«‹æ±‚
- **æª¢æŸ¥æœå‹™ç›¸ä¾æ€§**ï¼šè­˜åˆ¥æ¶‰åŠå“ªäº›ä¸Šæ¸¸/ä¸‹æ¸¸æœå‹™
- **åˆ†æç´šè¯å¤±æ•—**ï¼šåˆ¤æ–·é€™æ˜¯å¦ç‚ºä¸åŒæœå‹™å¤±æ•—çš„ç—‡ç‹€
- **æª¢é–±æ–·è·¯å™¨ç‹€æ…‹**ï¼šæª¢æŸ¥ä¿è­·æ©Ÿåˆ¶æ˜¯å¦è¢«è§¸ç™¼
- **æª¢æŸ¥è¨Šæ¯ä½‡åˆ—**ï¼šå°‹æ‰¾èƒŒå£“ã€æ­»ä¿¡æˆ–è™•ç†å»¶é²
- **æ™‚é–“è»¸é‡å»º**ï¼šä½¿ç”¨åˆ†æ•£å¼è¿½è¹¤å»ºç«‹æ‰€æœ‰æœå‹™çš„äº‹ä»¶æ™‚é–“è»¸

## å †ç–Šè¿½è¹¤åˆ†æ

### è§£è®€å †ç–Šè¿½è¹¤

å¾å †ç–Šè¿½è¹¤ä¸­æ“·å–æœ€å¤§è³‡è¨Šï¼š

**é—œéµå…ƒç´ ï¼š**
- **éŒ¯èª¤é¡å‹**ï¼šç™¼ç”Ÿäº†ä»€éº¼é¡å‹çš„ä¾‹å¤–/éŒ¯èª¤
- **éŒ¯èª¤è¨Šæ¯**ï¼šé—œæ–¼å¤±æ•—çš„ä¸Šä¸‹æ–‡è³‡è¨Š
- **èµ·æºé»**ï¼šæ‹‹å‡ºéŒ¯èª¤çš„æœ€æ·±å±¤å †ç–Šæ¡†æ¶
- **å‘¼å«éˆ**ï¼šå°è‡´éŒ¯èª¤çš„å‡½å¼å‘¼å«åºåˆ—
- **æ¡†æ¶ vs æ‡‰ç”¨ç¨‹å¼ç¨‹å¼ç¢¼**ï¼šå€åˆ†ç¨‹å¼åº«å’Œæ‚¨çš„ç¨‹å¼ç¢¼
- **éåŒæ­¥é‚Šç•Œ**ï¼šè­˜åˆ¥éåŒæ­¥æ“ä½œä¸­æ–·è¿½è¹¤çš„ä½ç½®

**åˆ†æç­–ç•¥ï¼š**
1. å¾å †ç–Šé ‚éƒ¨é–‹å§‹ï¼ˆéŒ¯èª¤èµ·æºï¼‰
2. è­˜åˆ¥æ‡‰ç”¨ç¨‹å¼ç¨‹å¼ç¢¼ä¸­çš„ç¬¬ä¸€å€‹æ¡†æ¶ï¼ˆéæ¡†æ¶/ç¨‹å¼åº«ï¼‰
3. æª¢æŸ¥è©²æ¡†æ¶çš„ä¸Šä¸‹æ–‡ï¼šè¼¸å…¥åƒæ•¸ã€å€åŸŸè®Šæ•¸ã€ç‹€æ…‹
4. é€éå‘¼å«å‡½å¼å‘å¾Œè¿½æº¯ï¼Œäº†è§£ç„¡æ•ˆç‹€æ…‹æ˜¯å¦‚ä½•å»ºç«‹çš„
5. å°‹æ‰¾æ¨¡å¼ï¼šé€™æ˜¯åœ¨è¿´åœˆä¸­ï¼Ÿå›å‘¼å…§ï¼ŸéåŒæ­¥æ“ä½œå¾Œï¼Ÿ

### å †ç–Šè¿½è¹¤å¢å¼·

ç¾ä»£éŒ¯èª¤è¿½è¹¤å·¥å…·æä¾›å¢å¼·çš„å †ç–Šè¿½è¹¤ï¼š

- **åŸå§‹ç¢¼ä¸Šä¸‹æ–‡**ï¼šæª¢è¦–æ¯å€‹æ¡†æ¶çš„å‘¨åœç¨‹å¼ç¢¼è¡Œ
- **å€åŸŸè®Šæ•¸å€¼**ï¼šæª¢æŸ¥æ¯å€‹æ¡†æ¶çš„è®Šæ•¸ç‹€æ…‹ï¼ˆä½¿ç”¨ Sentry çš„é™¤éŒ¯æ¨¡å¼ï¼‰
- **éºµåŒ…å±‘**ï¼šæŸ¥çœ‹å°è‡´éŒ¯èª¤çš„äº‹ä»¶åºåˆ—
- **ç™¼å¸ƒè¿½è¹¤**ï¼šå°‡éŒ¯èª¤é€£çµåˆ°ç‰¹å®šéƒ¨ç½²å’Œæäº¤
- **Source Maps**ï¼šå°æ–¼å£“ç¸®çš„ JavaScriptï¼Œæ˜ å°„å›åŸå§‹åŸå§‹ç¢¼
- **è¡Œå…§è¨»è§£**ï¼šä½¿ç”¨ä¸Šä¸‹æ–‡è³‡è¨Šè¨»è§£å †ç–Šæ¡†æ¶

### å¸¸è¦‹å †ç–Šè¿½è¹¤æ¨¡å¼

**æ¨¡å¼ï¼šæ¡†æ¶ç¨‹å¼ç¢¼æ·±è™•çš„ç©ºæŒ‡æ¨™ä¾‹å¤–**
```
NullPointerException
  at java.util.HashMap.hash(HashMap.java:339)
  at java.util.HashMap.get(HashMap.java:556)
  at com.myapp.service.UserService.findUser(UserService.java:45)
```
æ ¹æœ¬åŸå› ï¼šæ‡‰ç”¨ç¨‹å¼å°‡ null å‚³éçµ¦æ¡†æ¶ç¨‹å¼ç¢¼ã€‚å°ˆæ³¨æ–¼ UserService.java:45ã€‚

**æ¨¡å¼ï¼šé•·æ™‚é–“ç­‰å¾…å¾Œé€¾æ™‚**
```
TimeoutException: Operation timed out after 30000ms
  at okhttp3.internal.http2.Http2Stream.waitForIo
  at com.myapp.api.PaymentClient.processPayment(PaymentClient.java:89)
```
æ ¹æœ¬åŸå› ï¼šå¤–éƒ¨æœå‹™ç·©æ…¢/ç„¡å›æ‡‰ã€‚éœ€è¦é‡è©¦é‚è¼¯å’Œæ–·è·¯å™¨ã€‚

**æ¨¡å¼ï¼šä¸¦è¡Œç¨‹å¼ç¢¼ä¸­çš„ç«¶çˆ­æ¢ä»¶**
```
ConcurrentModificationException
  at java.util.ArrayList$Itr.checkForComodification
  at com.myapp.processor.BatchProcessor.process(BatchProcessor.java:112)
```
æ ¹æœ¬åŸå› ï¼šåœ¨è¿­ä»£æ™‚ä¿®æ”¹é›†åˆã€‚éœ€è¦åŸ·è¡Œç·’å®‰å…¨çš„è³‡æ–™çµæ§‹æˆ–åŒæ­¥ã€‚

## æ—¥èªŒèšåˆèˆ‡æ¨¡å¼æ¯”å°

### çµæ§‹åŒ–æ—¥èªŒå¯¦ä½œ

å¯¦ä½œåŸºæ–¼ JSON çš„çµæ§‹åŒ–æ—¥èªŒï¼Œä»¥æä¾›æ©Ÿå™¨å¯è®€çš„æ—¥èªŒï¼š

**æ¨™æº–æ—¥èªŒ Schemaï¼š**
```json
{
  "timestamp": "2025-10-11T14:23:45.123Z",
  "level": "ERROR",
  "correlation_id": "req-7f3b2a1c-4d5e-6f7g-8h9i-0j1k2l3m4n5o",
  "trace_id": "4bf92f3577b34da6a3ce929d0e0e4736",
  "span_id": "00f067aa0ba902b7",
  "service": "payment-service",
  "environment": "production",
  "host": "pod-payment-7d4f8b9c-xk2l9",
  "version": "v2.3.1",
  "error": {
    "type": "PaymentProcessingException",
    "message": "Failed to charge card: Insufficient funds",
    "stack_trace": "...",
    "fingerprint": "payment-insufficient-funds"
  },
  "user": {
    "id": "user-12345",
    "ip": "203.0.113.42",
    "session_id": "sess-abc123"
  },
  "request": {
    "method": "POST",
    "path": "/api/v1/payments/charge",
    "duration_ms": 2547,
    "status_code": 402
  },
  "context": {
    "payment_method": "credit_card",
    "amount": 149.99,
    "currency": "USD",
    "merchant_id": "merchant-789"
  }
}
```

**å¿…é ˆåŒ…å«çš„é—œéµæ¬„ä½ï¼š**
- `timestamp`ï¼šUTC çš„ ISO 8601 æ ¼å¼
- `level`ï¼šERRORã€WARNã€INFOã€DEBUGã€TRACE
- `correlation_id`ï¼šæ•´å€‹è«‹æ±‚éˆçš„å”¯ä¸€ ID
- `trace_id` å’Œ `span_id`ï¼šOpenTelemetry åˆ†æ•£å¼è¿½è¹¤è­˜åˆ¥ç¢¼
- `service`ï¼šç”¢ç”Ÿæ­¤æ—¥èªŒçš„å¾®æœå‹™
- `environment`ï¼šdevã€stagingã€production
- `error.fingerprint`ï¼šç”¨æ–¼åˆ†çµ„é¡ä¼¼éŒ¯èª¤çš„ç©©å®šè­˜åˆ¥ç¢¼

### é—œè¯ ID æ¨¡å¼

å¯¦ä½œé—œè¯ ID ä»¥è¿½è¹¤è·¨åˆ†æ•£å¼ç³»çµ±çš„è«‹æ±‚ï¼š

**Node.js/Express ä¸­ä»‹è»Ÿé«”ï¼š**
```javascript
const { v4: uuidv4 } = require('uuid');
const asyncLocalStorage = require('async-local-storage');

// Middleware to generate/propagate correlation ID
function correlationIdMiddleware(req, res, next) {
  const correlationId = req.headers['x-correlation-id'] || uuidv4();
  req.correlationId = correlationId;
  res.setHeader('x-correlation-id', correlationId);

  // Store in async context for access in nested calls
  asyncLocalStorage.run(new Map(), () => {
    asyncLocalStorage.set('correlationId', correlationId);
    next();
  });
}

// Propagate to downstream services
function makeApiCall(url, data) {
  const correlationId = asyncLocalStorage.get('correlationId');
  return axios.post(url, data, {
    headers: {
      'x-correlation-id': correlationId,
      'x-source-service': 'api-gateway'
    }
  });
}

// Include in all log statements
function log(level, message, context = {}) {
  const correlationId = asyncLocalStorage.get('correlationId');
  console.log(JSON.stringify({
    timestamp: new Date().toISOString(),
    level,
    correlation_id: correlationId,
    message,
    ...context
  }));
}
```

**Python/Flask å¯¦ä½œï¼š**
```python
import uuid
import logging
from flask import request, g
import json

class CorrelationIdFilter(logging.Filter):
    def filter(self, record):
        record.correlation_id = g.get('correlation_id', 'N/A')
        return True

@app.before_request
def setup_correlation_id():
    correlation_id = request.headers.get('X-Correlation-ID', str(uuid.uuid4()))
    g.correlation_id = correlation_id

@app.after_request
def add_correlation_header(response):
    response.headers['X-Correlation-ID'] = g.correlation_id
    return response

# Structured logging with correlation ID
logging.basicConfig(
    format='%(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)
logger.addFilter(CorrelationIdFilter())

def log_structured(level, message, **context):
    log_entry = {
        'timestamp': datetime.utcnow().isoformat() + 'Z',
        'level': level,
        'correlation_id': g.correlation_id,
        'service': 'payment-service',
        'message': message,
        **context
    }
    logger.log(getattr(logging, level), json.dumps(log_entry))
```

### æ—¥èªŒèšåˆæ¶æ§‹

**é›†ä¸­å¼æ—¥èªŒç®¡ç·šï¼š**
1. **æ‡‰ç”¨ç¨‹å¼**ï¼šå°‡çµæ§‹åŒ– JSON æ—¥èªŒè¼¸å‡ºåˆ° stdout/stderr
2. **æ—¥èªŒå‚³é€å™¨**ï¼šFluentd/Fluent Bit/Vector å¾å®¹å™¨æ”¶é›†æ—¥èªŒ
3. **æ—¥èªŒèšåˆå™¨**ï¼šElasticsearch/Loki/DataDog æ¥æ”¶ä¸¦ç´¢å¼•æ—¥èªŒ
4. **è¦–è¦ºåŒ–**ï¼šKibana/Grafana/DataDog UI ç”¨æ–¼æŸ¥è©¢å’Œå„€è¡¨æ¿
5. **è­¦å ±**ï¼šé‡å°éŒ¯èª¤æ¨¡å¼å’Œé–¾å€¼è§¸ç™¼è­¦å ±

**æ—¥èªŒæŸ¥è©¢ç¯„ä¾‹ï¼ˆElasticsearch DSLï¼‰ï¼š**
```json
// Find all errors for a specific correlation ID
{
  "query": {
    "bool": {
      "must": [
        { "match": { "correlation_id": "req-7f3b2a1c-4d5e-6f7g" }},
        { "term": { "level": "ERROR" }}
      ]
    }
  },
  "sort": [{ "timestamp": "asc" }]
}

// Find error rate spike in last hour
{
  "query": {
    "bool": {
      "must": [
        { "term": { "level": "ERROR" }},
        { "range": { "timestamp": { "gte": "now-1h" }}}
      ]
    }
  },
  "aggs": {
    "errors_per_minute": {
      "date_histogram": {
        "field": "timestamp",
        "fixed_interval": "1m"
      }
    }
  }
}

// Group errors by fingerprint to find most common issues
{
  "query": {
    "term": { "level": "ERROR" }
  },
  "aggs": {
    "error_types": {
      "terms": {
        "field": "error.fingerprint",
        "size": 10
      },
      "aggs": {
        "affected_users": {
          "cardinality": { "field": "user.id" }
        }
      }
    }
  }
}
```

### æ¨¡å¼åµæ¸¬èˆ‡ç•°å¸¸è­˜åˆ¥

ä½¿ç”¨æ—¥èªŒåˆ†æè­˜åˆ¥æ¨¡å¼ï¼š

- **éŒ¯èª¤ç‡æ¿€å¢**ï¼šå°‡ç•¶å‰éŒ¯èª¤ç‡èˆ‡æ­·å²åŸºæº–æ¯”è¼ƒï¼ˆä¾‹å¦‚ï¼Œ>3 å€‹æ¨™æº–å·®ï¼‰
- **æ–°éŒ¯èª¤é¡å‹**ï¼šåœ¨å‡ºç¾å…ˆå‰æœªè¦‹éçš„éŒ¯èª¤æŒ‡ç´‹æ™‚ç™¼å‡ºè­¦å ±
- **ç´šè¯å¤±æ•—**ï¼šåµæ¸¬ä¸€å€‹æœå‹™ä¸­çš„éŒ¯èª¤ä½•æ™‚è§¸ç™¼ç›¸ä¾æœå‹™ä¸­çš„éŒ¯èª¤
- **ä½¿ç”¨è€…å½±éŸ¿æ¨¡å¼**ï¼šè­˜åˆ¥å“ªäº›ä½¿ç”¨è€…/å€æ®µå—åˆ°ä¸æˆæ¯”ä¾‹çš„å½±éŸ¿
- **åœ°ç†æ¨¡å¼**ï¼šç™¼ç¾ç‰¹å®šå€åŸŸçš„å•é¡Œï¼ˆä¾‹å¦‚ï¼ŒCDN å•é¡Œã€è³‡æ–™ä¸­å¿ƒä¸­æ–·ï¼‰
- **æ™‚é–“æ¨¡å¼**ï¼šå°‹æ‰¾åŸºæ–¼æ™‚é–“çš„å•é¡Œï¼ˆä¾‹å¦‚ï¼Œæ‰¹æ¬¡ä½œæ¥­ã€æ’ç¨‹ä»»å‹™ã€æ™‚å€éŒ¯èª¤ï¼‰

## é™¤éŒ¯å·¥ä½œæµç¨‹

### äº’å‹•å¼é™¤éŒ¯

é‡å°é–‹ç™¼ä¸­çš„ç¢ºå®šæ€§éŒ¯èª¤ï¼š

**é™¤éŒ¯å™¨è¨­å®šï¼š**
1. åœ¨éŒ¯èª¤ç™¼ç”Ÿå‰è¨­å®šä¸­æ–·é»
2. é€è¡ŒåŸ·è¡Œç¨‹å¼ç¢¼
3. æª¢æŸ¥è®Šæ•¸å€¼å’Œç‰©ä»¶ç‹€æ…‹
4. åœ¨é™¤éŒ¯ä¸»æ§å°ä¸­è©•ä¼°è¡¨é”å¼
5. è§€å¯Ÿæ„å¤–çš„ç‹€æ…‹è®ŠåŒ–
6. ä¿®æ”¹è®Šæ•¸ä»¥æ¸¬è©¦å‡è¨­

**ç¾ä»£é™¤éŒ¯å·¥å…·ï¼š**
- **VS Code Debugger**ï¼šæ•´åˆé™¤éŒ¯ï¼Œæ”¯æ´ JavaScriptã€Pythonã€Goã€Javaã€C++
- **Chrome DevTools**ï¼šå‰ç«¯é™¤éŒ¯ï¼ŒåŒ…å«ç¶²è·¯ã€æ•ˆèƒ½å’Œè¨˜æ†¶é«”åˆ†æ
- **pdb/ipdbï¼ˆPythonï¼‰**ï¼šå…·æœ‰äº‹å¾Œåˆ†æçš„äº’å‹•å¼é™¤éŒ¯å™¨
- **dlvï¼ˆGoï¼‰**ï¼šGo ç¨‹å¼çš„ Delve é™¤éŒ¯å™¨
- **lldbï¼ˆC/C++ï¼‰**ï¼šå…·æœ‰åå‘é™¤éŒ¯èƒ½åŠ›çš„ä½éšé™¤éŒ¯å™¨

### æ­£å¼ç’°å¢ƒé™¤éŒ¯

é‡å°æ­£å¼ç’°å¢ƒä¸­é™¤éŒ¯å™¨ä¸å¯ç”¨çš„éŒ¯èª¤ï¼š

**å®‰å…¨çš„æ­£å¼ç’°å¢ƒé™¤éŒ¯æŠ€è¡“ï¼š**

1. **å¢å¼·æ—¥èªŒ**ï¼šåœ¨ç–‘ä¼¼å¤±æ•—é»å‘¨åœæ–°å¢ç­–ç•¥æ€§æ—¥èªŒé™³è¿°
2. **åŠŸèƒ½æ——æ¨™**ï¼šç‚ºç‰¹å®šä½¿ç”¨è€…/è«‹æ±‚å•Ÿç”¨è©³ç´°æ—¥èªŒ
3. **å–æ¨£**ï¼šç‚ºä¸€å®šç™¾åˆ†æ¯”çš„è«‹æ±‚è¨˜éŒ„è©³ç´°ä¸Šä¸‹æ–‡
4. **APM äº¤æ˜“è¿½è¹¤**ï¼šä½¿ç”¨ DataDog APM æˆ– New Relic æŸ¥çœ‹è©³ç´°çš„äº¤æ˜“æµç¨‹
5. **åˆ†æ•£å¼è¿½è¹¤**ï¼šåˆ©ç”¨ OpenTelemetry è¿½è¹¤äº†è§£è·¨æœå‹™äº’å‹•
6. **åˆ†æ**ï¼šä½¿ç”¨æŒçºŒåˆ†æå™¨ï¼ˆDataDog Profilerã€Pyroscopeï¼‰è­˜åˆ¥ç†±é»
7. **å †ç©å‚¾å°**ï¼šæ“·å–è¨˜æ†¶é«”å¿«ç…§ä»¥åˆ†æè¨˜æ†¶é«”æ´©æ¼
8. **æµé‡é¡åƒ**ï¼šåœ¨é å‚™ç’°å¢ƒä¸­é‡æ’­æ­£å¼ç’°å¢ƒæµé‡ä»¥å®‰å…¨èª¿æŸ¥

**é ç«¯é™¤éŒ¯ï¼ˆè¬¹æ…ä½¿ç”¨ï¼‰ï¼š**
- åƒ…åœ¨éé—œéµæœå‹™ä¸­é™„åŠ é™¤éŒ¯å™¨åˆ°åŸ·è¡Œä¸­çš„ç¨‹åº
- ä½¿ç”¨ä¸æš«åœåŸ·è¡Œçš„å”¯è®€ä¸­æ–·é»
- åš´æ ¼é™åˆ¶é™¤éŒ¯å·¥ä½œéšæ®µæ™‚é–“
- å§‹çµ‚æº–å‚™å¥½å¾©åŸè¨ˆç•«

### è¨˜æ†¶é«”èˆ‡æ•ˆèƒ½é™¤éŒ¯

**è¨˜æ†¶é«”æ´©æ¼åµæ¸¬ï¼š**
```javascript
// Node.js heap snapshot comparison
const v8 = require('v8');
const fs = require('fs');

function takeHeapSnapshot(filename) {
  const snapshot = v8.writeHeapSnapshot(filename);
  console.log(`Heap snapshot written to ${snapshot}`);
}

// Take snapshots at intervals
takeHeapSnapshot('heap-before.heapsnapshot');
// ... run operations that might leak ...
takeHeapSnapshot('heap-after.heapsnapshot');

// Analyze in Chrome DevTools Memory profiler
// Look for objects with increasing retained size
```

**æ•ˆèƒ½åˆ†æï¼š**
```python
# Python profiling with cProfile
import cProfile
import pstats
from pstats import SortKey

def profile_function():
    profiler = cProfile.Profile()
    profiler.enable()

    # Your code here
    process_large_dataset()

    profiler.disable()

    stats = pstats.Stats(profiler)
    stats.sort_stats(SortKey.CUMULATIVE)
    stats.print_stats(20)  # Top 20 time-consuming functions
```

## éŒ¯èª¤é é˜²ç­–ç•¥

### è¼¸å…¥é©—è­‰èˆ‡å‹åˆ¥å®‰å…¨

**é˜²ç¦¦æ€§ç¨‹å¼è¨­è¨ˆï¼š**
```typescript
// TypeScript: Leverage type system for compile-time safety
interface PaymentRequest {
  amount: number;
  currency: string;
  customerId: string;
  paymentMethodId: string;
}

function processPayment(request: PaymentRequest): PaymentResult {
  // Runtime validation for external inputs
  if (request.amount <= 0) {
    throw new ValidationError('Amount must be positive');
  }

  if (!['USD', 'EUR', 'GBP'].includes(request.currency)) {
    throw new ValidationError('Unsupported currency');
  }

  // Use Zod or Yup for complex validation
  const schema = z.object({
    amount: z.number().positive().max(1000000),
    currency: z.enum(['USD', 'EUR', 'GBP']),
    customerId: z.string().uuid(),
    paymentMethodId: z.string().min(1)
  });

  const validated = schema.parse(request);

  // Now safe to process
  return chargeCustomer(validated);
}
```

**Python å‹åˆ¥æç¤ºèˆ‡é©—è­‰ï¼š**
```python
from typing import Optional
from pydantic import BaseModel, validator, Field
from decimal import Decimal

class PaymentRequest(BaseModel):
    amount: Decimal = Field(..., gt=0, le=1000000)
    currency: str
    customer_id: str
    payment_method_id: str

    @validator('currency')
    def validate_currency(cls, v):
        if v not in ['USD', 'EUR', 'GBP']:
            raise ValueError('Unsupported currency')
        return v

    @validator('customer_id', 'payment_method_id')
    def validate_ids(cls, v):
        if not v or len(v) < 1:
            raise ValueError('ID cannot be empty')
        return v

def process_payment(request: PaymentRequest) -> PaymentResult:
    # Pydantic validates automatically on instantiation
    # Type hints provide IDE support and static analysis
    return charge_customer(request)
```

### éŒ¯èª¤é‚Šç•Œèˆ‡å„ªé›…é™ç´š

**React éŒ¯èª¤é‚Šç•Œï¼š**
```typescript
import React, { Component, ErrorInfo, ReactNode } from 'react';
import * as Sentry from '@sentry/react';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error?: Error;
}

class ErrorBoundary extends Component<Props, State> {
  public state: State = {
    hasError: false
  };

  public static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    // Log to error tracking service
    Sentry.captureException(error, {
      contexts: {
        react: {
          componentStack: errorInfo.componentStack
        }
      }
    });

    console.error('Uncaught error:', error, errorInfo);
  }

  public render() {
    if (this.state.hasError) {
      return this.props.fallback || (
        <div role="alert">
          <h2>Something went wrong</h2>
          <details>
            <summary>Error details</summary>
            <pre>{this.state.error?.message}</pre>
          </details>
        </div>
      );
    }

    return this.props.children;
  }
}

export default ErrorBoundary;
```

**æ–·è·¯å™¨æ¨¡å¼ï¼š**
```python
from datetime import datetime, timedelta
from enum import Enum
import time

class CircuitState(Enum):
    CLOSED = "closed"      # Normal operation
    OPEN = "open"          # Failing, reject requests
    HALF_OPEN = "half_open"  # Testing if service recovered

class CircuitBreaker:
    def __init__(self, failure_threshold=5, timeout=60, success_threshold=2):
        self.failure_threshold = failure_threshold
        self.timeout = timeout
        self.success_threshold = success_threshold
        self.failure_count = 0
        self.success_count = 0
        self.last_failure_time = None
        self.state = CircuitState.CLOSED

    def call(self, func, *args, **kwargs):
        if self.state == CircuitState.OPEN:
            if self._should_attempt_reset():
                self.state = CircuitState.HALF_OPEN
            else:
                raise CircuitBreakerOpenError("Circuit breaker is OPEN")

        try:
            result = func(*args, **kwargs)
            self._on_success()
            return result
        except Exception as e:
            self._on_failure()
            raise

    def _on_success(self):
        self.failure_count = 0
        if self.state == CircuitState.HALF_OPEN:
            self.success_count += 1
            if self.success_count >= self.success_threshold:
                self.state = CircuitState.CLOSED
                self.success_count = 0

    def _on_failure(self):
        self.failure_count += 1
        self.last_failure_time = datetime.now()
        if self.failure_count >= self.failure_threshold:
            self.state = CircuitState.OPEN

    def _should_attempt_reset(self):
        return (datetime.now() - self.last_failure_time) > timedelta(seconds=self.timeout)

# Usage
payment_circuit = CircuitBreaker(failure_threshold=5, timeout=60)

def process_payment_with_circuit_breaker(payment_data):
    try:
        result = payment_circuit.call(external_payment_api.charge, payment_data)
        return result
    except CircuitBreakerOpenError:
        # Graceful degradation: queue for later processing
        payment_queue.enqueue(payment_data)
        return {"status": "queued", "message": "Payment will be processed shortly"}
```

### æŒ‡æ•¸é€€é¿é‡è©¦é‚è¼¯

```typescript
// TypeScript retry implementation
interface RetryOptions {
  maxAttempts: number;
  baseDelayMs: number;
  maxDelayMs: number;
  exponentialBase: number;
  retryableErrors?: string[];
}

async function retryWithBackoff<T>(
  fn: () => Promise<T>,
  options: RetryOptions = {
    maxAttempts: 3,
    baseDelayMs: 1000,
    maxDelayMs: 30000,
    exponentialBase: 2
  }
): Promise<T> {
  let lastError: Error;

  for (let attempt = 0; attempt < options.maxAttempts; attempt++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error as Error;

      // Check if error is retryable
      if (options.retryableErrors &&
          !options.retryableErrors.includes(error.name)) {
        throw error; // Don't retry non-retryable errors
      }

      if (attempt < options.maxAttempts - 1) {
        const delay = Math.min(
          options.baseDelayMs * Math.pow(options.exponentialBase, attempt),
          options.maxDelayMs
        );

        // Add jitter to prevent thundering herd
        const jitter = Math.random() * 0.1 * delay;
        const actualDelay = delay + jitter;

        console.log(`Attempt ${attempt + 1} failed, retrying in ${actualDelay}ms`);
        await new Promise(resolve => setTimeout(resolve, actualDelay));
      }
    }
  }

  throw lastError!;
}

// Usage
const result = await retryWithBackoff(
  () => fetch('https://api.example.com/data'),
  {
    maxAttempts: 3,
    baseDelayMs: 1000,
    maxDelayMs: 10000,
    exponentialBase: 2,
    retryableErrors: ['NetworkError', 'TimeoutError']
  }
);
```

## ç›£æ§èˆ‡è­¦å ±æ•´åˆ

### ç¾ä»£å¯è§€æ¸¬æ€§å †ç–Šï¼ˆ2025ï¼‰

**å»ºè­°æ¶æ§‹ï¼š**
- **Metrics**ï¼šPrometheus + Grafana æˆ– DataDog
- **Logs**ï¼šElasticsearch/Loki + Fluentd æˆ– DataDog Logs
- **Traces**ï¼šOpenTelemetry + Jaeger/Tempo æˆ– DataDog APM
- **Errors**ï¼šSentry æˆ– DataDog Error Tracking
- **Frontend**ï¼šSentry Browser SDK æˆ– DataDog RUM
- **Synthetics**ï¼šDataDog Synthetics æˆ– Checkly

### Sentry æ•´åˆ

**Node.js/Express è¨­å®šï¼š**
```javascript
const Sentry = require('@sentry/node');
const { ProfilingIntegration } = require('@sentry/profiling-node');

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  release: process.env.GIT_COMMIT_SHA,

  // Performance monitoring
  tracesSampleRate: 0.1, // 10% of transactions
  profilesSampleRate: 0.1,

  integrations: [
    new ProfilingIntegration(),
    new Sentry.Integrations.Http({ tracing: true }),
    new Sentry.Integrations.Express({ app }),
  ],

  beforeSend(event, hint) {
    // Scrub sensitive data
    if (event.request) {
      delete event.request.cookies;
      delete event.request.headers?.authorization;
    }

    // Add custom context
    event.tags = {
      ...event.tags,
      region: process.env.AWS_REGION,
      instance_id: process.env.INSTANCE_ID
    };

    return event;
  }
});

// Express middleware
app.use(Sentry.Handlers.requestHandler());
app.use(Sentry.Handlers.tracingHandler());

// Routes here...

// Error handler (must be last)
app.use(Sentry.Handlers.errorHandler());

// Manual error capture with context
function processOrder(orderId) {
  try {
    const order = getOrder(orderId);
    chargeCustomer(order);
  } catch (error) {
    Sentry.captureException(error, {
      tags: {
        operation: 'process_order',
        order_id: orderId
      },
      contexts: {
        order: {
          id: orderId,
          status: order?.status,
          amount: order?.amount
        }
      },
      user: {
        id: order?.customerId
      }
    });
    throw error;
  }
}
```

### DataDog APM æ•´åˆ

**Python/Flask è¨­å®šï¼š**
```python
from ddtrace import patch_all, tracer
from ddtrace.contrib.flask import TraceMiddleware
import logging

# Auto-instrument common libraries
patch_all()

app = Flask(__name__)

# Initialize tracing
TraceMiddleware(app, tracer, service='payment-service')

# Custom span for detailed tracing
@app.route('/api/v1/payments/charge', methods=['POST'])
def charge_payment():
    with tracer.trace('payment.charge', service='payment-service') as span:
        payment_data = request.json

        # Add custom tags
        span.set_tag('payment.amount', payment_data['amount'])
        span.set_tag('payment.currency', payment_data['currency'])
        span.set_tag('customer.id', payment_data['customer_id'])

        try:
            result = payment_processor.charge(payment_data)
            span.set_tag('payment.status', 'success')
            return jsonify(result), 200
        except InsufficientFundsError as e:
            span.set_tag('payment.status', 'insufficient_funds')
            span.set_tag('error', True)
            return jsonify({'error': 'Insufficient funds'}), 402
        except Exception as e:
            span.set_tag('payment.status', 'error')
            span.set_tag('error', True)
            span.set_tag('error.message', str(e))
            raise
```

### OpenTelemetry å¯¦ä½œ

**ä½¿ç”¨ OpenTelemetry çš„ Go æœå‹™ï¼š**
```go
package main

import (
    "context"
    "go.opentelemetry.io/otel"
    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc"
    "go.opentelemetry.io/otel/sdk/trace"
    sdktrace "go.opentelemetry.io/otel/sdk/trace"
    "go.opentelemetry.io/otel/attribute"
    "go.opentelemetry.io/otel/codes"
)

func initTracer() (*sdktrace.TracerProvider, error) {
    exporter, err := otlptracegrpc.New(
        context.Background(),
        otlptracegrpc.WithEndpoint("otel-collector:4317"),
        otlptracegrpc.WithInsecure(),
    )
    if err != nil {
        return nil, err
    }

    tp := sdktrace.NewTracerProvider(
        sdktrace.WithBatcher(exporter),
        sdktrace.WithResource(resource.NewWithAttributes(
            semconv.SchemaURL,
            semconv.ServiceNameKey.String("payment-service"),
            semconv.ServiceVersionKey.String("v2.3.1"),
            attribute.String("environment", "production"),
        )),
    )

    otel.SetTracerProvider(tp)
    return tp, nil
}

func processPayment(ctx context.Context, paymentReq PaymentRequest) error {
    tracer := otel.Tracer("payment-service")
    ctx, span := tracer.Start(ctx, "processPayment")
    defer span.End()

    // Add attributes
    span.SetAttributes(
        attribute.Float64("payment.amount", paymentReq.Amount),
        attribute.String("payment.currency", paymentReq.Currency),
        attribute.String("customer.id", paymentReq.CustomerID),
    )

    // Call downstream service
    err := chargeCard(ctx, paymentReq)
    if err != nil {
        span.RecordError(err)
        span.SetStatus(codes.Error, err.Error())
        return err
    }

    span.SetStatus(codes.Ok, "Payment processed successfully")
    return nil
}

func chargeCard(ctx context.Context, paymentReq PaymentRequest) error {
    tracer := otel.Tracer("payment-service")
    ctx, span := tracer.Start(ctx, "chargeCard")
    defer span.End()

    // Simulate external API call
    result, err := paymentGateway.Charge(ctx, paymentReq)
    if err != nil {
        return fmt.Errorf("payment gateway error: %w", err)
    }

    span.SetAttributes(
        attribute.String("transaction.id", result.TransactionID),
        attribute.String("gateway.response_code", result.ResponseCode),
    )

    return nil
}
```

### è­¦å ±è¨­å®š

**æ™ºæ…§è­¦å ±ç­–ç•¥ï¼š**

```yaml
# DataDog Monitor Configuration
monitors:
  - name: "High Error Rate - Payment Service"
    type: metric
    query: "avg(last_5m):sum:trace.express.request.errors{service:payment-service} / sum:trace.express.request.hits{service:payment-service} > 0.05"
    message: |
      Payment service error rate is {{value}}% (threshold: 5%)

      This may indicate:
      - Payment gateway issues
      - Database connectivity problems
      - Invalid payment data

      Runbook: https://wiki.company.com/runbooks/payment-errors

      @slack-payments-oncall @pagerduty-payments

    tags:
      - service:payment-service
      - severity:high

    options:
      notify_no_data: true
      no_data_timeframe: 10
      escalation_message: "Error rate still elevated after 10 minutes"

  - name: "New Error Type Detected"
    type: log
    query: "logs(\"level:ERROR service:payment-service\").rollup(\"count\").by(\"error.fingerprint\").last(\"5m\") > 0"
    message: |
      New error type detected in payment service: {{error.fingerprint}}

      First occurrence: {{timestamp}}
      Affected users: {{user_count}}

      @slack-engineering

    options:
      enable_logs_sample: true

  - name: "Payment Service - P95 Latency High"
    type: metric
    query: "avg(last_10m):p95:trace.express.request.duration{service:payment-service} > 2000"
    message: |
      Payment service P95 latency is {{value}}ms (threshold: 2000ms)

      Check:
      - Database query performance
      - External API response times
      - Resource constraints (CPU/memory)

      Dashboard: https://app.datadoghq.com/dashboard/payment-service

      @slack-payments-team
```

## æ­£å¼ç’°å¢ƒäº‹ä»¶å›æ‡‰

### äº‹ä»¶å›æ‡‰å·¥ä½œæµç¨‹

**éšæ®µ 1ï¼šåµæ¸¬èˆ‡åˆ†é¡ï¼ˆ0-5 åˆ†é˜ï¼‰**
1. ç¢ºèªè­¦å ±/äº‹ä»¶
2. æª¢æŸ¥äº‹ä»¶åš´é‡æ€§å’Œä½¿ç”¨è€…å½±éŸ¿
3. æŒ‡æ´¾äº‹ä»¶æŒ‡æ®å®˜
4. å»ºç«‹äº‹ä»¶é »é“ï¼ˆ#incident-2025-10-11-payment-errorsï¼‰
5. å¦‚ç‚ºé¢å‘å®¢æˆ¶çš„å•é¡Œï¼Œæ›´æ–°ç‹€æ…‹é é¢

**éšæ®µ 2ï¼šèª¿æŸ¥ï¼ˆ5-30 åˆ†é˜ï¼‰**
1. æ”¶é›†å¯è§€æ¸¬æ€§è³‡æ–™ï¼š
   - ä¾†è‡ª Sentry/DataDog çš„éŒ¯èª¤ç‡
   - é¡¯ç¤ºå¤±æ•—è«‹æ±‚çš„è¿½è¹¤
   - äº‹ä»¶é–‹å§‹æ™‚é–“é™„è¿‘çš„æ—¥èªŒ
   - é¡¯ç¤ºè³‡æºä½¿ç”¨ã€å»¶é²ã€ååé‡çš„æŒ‡æ¨™
2. èˆ‡æœ€è¿‘è®Šæ›´é—œè¯ï¼š
   - æœ€è¿‘çš„éƒ¨ç½²ï¼ˆæª¢æŸ¥ CI/CD ç®¡ç·šï¼‰
   - è¨­å®šè®Šæ›´
   - åŸºç¤è¨­æ–½è®Šæ›´
   - å¤–éƒ¨ç›¸ä¾æ€§ç‹€æ…‹
3. å½¢æˆé—œæ–¼æ ¹æœ¬åŸå› çš„åˆæ­¥å‡è¨­
4. åœ¨äº‹ä»¶æ—¥èªŒä¸­è¨˜éŒ„ç™¼ç¾

**éšæ®µ 3ï¼šç·©è§£ï¼ˆç«‹å³ï¼‰**
1. æ ¹æ“šå‡è¨­å¯¦æ–½ç«‹å³ä¿®å¾©ï¼š
   - å¾©åŸæœ€è¿‘çš„éƒ¨ç½²
   - æ“´å±•è³‡æº
   - åœç”¨æœ‰å•é¡Œçš„åŠŸèƒ½ï¼ˆåŠŸèƒ½æ——æ¨™ï¼‰
   - æ•…éšœè½‰ç§»åˆ°å‚™ä»½ç³»çµ±
   - å¥—ç”¨ç†±ä¿®å¾©
2. é©—è­‰ç·©è§£æªæ–½æœ‰æ•ˆï¼ˆéŒ¯èª¤ç‡ä¸‹é™ï¼‰
3. ç›£æ§ 15-30 åˆ†é˜ä»¥ç¢ºä¿ç©©å®šæ€§

**éšæ®µ 4ï¼šå¾©åŸèˆ‡é©—è­‰**
1. é©—è­‰æ‰€æœ‰ç³»çµ±é‹ä½œæ­£å¸¸
2. æª¢æŸ¥è³‡æ–™ä¸€è‡´æ€§
3. è™•ç†ä½‡åˆ—/å¤±æ•—çš„è«‹æ±‚
4. æ›´æ–°ç‹€æ…‹é é¢ï¼šäº‹ä»¶å·²è§£æ±º
5. é€šçŸ¥åˆ©å®³é—œä¿‚äºº

**éšæ®µ 5ï¼šäº‹å¾Œæª¢è¨**
1. åœ¨ 48 å°æ™‚å…§å®‰æ’äº‹å¾Œæª¢è¨æœƒè­°
2. å»ºç«‹è©³ç´°çš„äº‹ä»¶æ™‚é–“è»¸
3. è­˜åˆ¥æ ¹æœ¬åŸå› ï¼ˆå¯èƒ½èˆ‡åˆæ­¥å‡è¨­ä¸åŒï¼‰
4. è¨˜éŒ„ä¿ƒæˆå› ç´ 
5. å»ºç«‹è¡Œå‹•é …ç›®ä»¥ï¼š
   - é é˜²é¡ä¼¼äº‹ä»¶
   - æ”¹å–„åµæ¸¬æ™‚é–“
   - æ”¹å–„ç·©è§£æ™‚é–“
   - æ”¹å–„æºé€š

### äº‹ä»¶èª¿æŸ¥å·¥å…·

**å¸¸è¦‹äº‹ä»¶çš„æŸ¥è©¢æ¨¡å¼ï¼š**

```
# Find all errors for a specific time window (Elasticsearch)
GET /logs-*/_search
{
  "query": {
    "bool": {
      "must": [
        { "term": { "level": "ERROR" }},
        { "term": { "service": "payment-service" }},
        { "range": { "timestamp": {
          "gte": "2025-10-11T14:00:00Z",
          "lte": "2025-10-11T14:30:00Z"
        }}}
      ]
    }
  },
  "sort": [{ "timestamp": "asc" }],
  "size": 1000
}

# Find correlation between errors and deployments (DataDog)
# Use deployment tracking to overlay deployment markers on error graphs
# Query: sum:trace.express.request.errors{service:payment-service} by {version}

# Identify affected users (Sentry)
# Navigate to issue â†’ User Impact tab
# Shows: total users affected, new vs returning, geographic distribution

# Trace specific failed request (OpenTelemetry/Jaeger)
# Search by trace_id or correlation_id
# Visualize full request path across services
# Identify which service/span failed
```

### æºé€šç¯„æœ¬

**åˆå§‹äº‹ä»¶é€šçŸ¥ï¼š**
```
ğŸš¨ äº‹ä»¶ï¼šä»˜æ¬¾è™•ç†éŒ¯èª¤

åš´é‡æ€§ï¼šé«˜
ç‹€æ…‹ï¼šèª¿æŸ¥ä¸­
é–‹å§‹æ™‚é–“ï¼š2025-10-11 14:23 UTC
äº‹ä»¶æŒ‡æ®å®˜ï¼š@jane.smith

ç—‡ç‹€ï¼š
- ä»˜æ¬¾è™•ç†éŒ¯èª¤ç‡ï¼š15%ï¼ˆæ­£å¸¸ï¼š<1%ï¼‰
- å—å½±éŸ¿ä½¿ç”¨è€…ï¼šéå» 10 åˆ†é˜ç´„ 500 äºº
- éŒ¯èª¤ï¼šã€Œè³‡æ–™åº«é€£ç·šé€¾æ™‚ã€

å·²æ¡å–è¡Œå‹•ï¼š
- æ­£åœ¨èª¿æŸ¥è³‡æ–™åº«é€£ç·šæ± 
- æª¢æŸ¥æœ€è¿‘çš„éƒ¨ç½²
- ç›£æ§éŒ¯èª¤ç‡

æ›´æ–°ï¼šæ¯ 15 åˆ†é˜æä¾›æ›´æ–°
ç‹€æ…‹é é¢ï¼šhttps://status.company.com/incident/abc123
```

**ç·©è§£é€šçŸ¥ï¼š**
```
âœ… äº‹ä»¶æ›´æ–°ï¼šå·²å¥—ç”¨ç·©è§£æªæ–½

åš´é‡æ€§ï¼šé«˜ â†’ ä¸­
ç‹€æ…‹ï¼šå·²ç·©è§£
æŒçºŒæ™‚é–“ï¼š27 åˆ†é˜

æ ¹æœ¬åŸå› ï¼šç”±æ–¼ 14:00 UTC çš„ v2.3.1 éƒ¨ç½²ä¸­å¼•å…¥çš„é•·æ™‚é–“åŸ·è¡ŒæŸ¥è©¢ï¼Œ
è³‡æ–™åº«é€£ç·šæ± è€—ç›¡

ç·©è§£æªæ–½ï¼šå¾©åŸè‡³ v2.3.0

ç›®å‰ç‹€æ…‹ï¼š
- éŒ¯èª¤ç‡ï¼š0.5%ï¼ˆæ¢å¾©æ­£å¸¸ï¼‰
- æ‰€æœ‰ç³»çµ±é‹ä½œæ­£å¸¸
- æ­£åœ¨è™•ç†ä½‡åˆ—ä¸­çš„ä»˜æ¬¾

å¾ŒçºŒæ­¥é©Ÿï¼š
- ç›£æ§ 30 åˆ†é˜
- ä¿®å¾©æŸ¥è©¢æ•ˆèƒ½å•é¡Œ
- éƒ¨ç½²ç¶“éæ¸¬è©¦çš„ä¿®å¾©ç‰ˆæœ¬
- å®‰æ’äº‹å¾Œæª¢è¨
```

## éŒ¯èª¤åˆ†æäº¤ä»˜æˆæœ

é‡å°æ¯æ¬¡éŒ¯èª¤åˆ†æï¼Œæä¾›ï¼š

1. **éŒ¯èª¤æ‘˜è¦**ï¼šç™¼ç”Ÿäº†ä»€éº¼ã€ä½•æ™‚ç™¼ç”Ÿã€å½±éŸ¿ç¯„åœ
2. **æ ¹æœ¬åŸå› **ï¼šéŒ¯èª¤ç™¼ç”Ÿçš„æ ¹æœ¬åŸå› 
3. **è­‰æ“š**ï¼šæ”¯æŒè¨ºæ–·çš„å †ç–Šè¿½è¹¤ã€æ—¥èªŒã€æŒ‡æ¨™
4. **ç«‹å³ä¿®å¾©**ï¼šè§£æ±ºå•é¡Œçš„ç¨‹å¼ç¢¼è®Šæ›´
5. **æ¸¬è©¦ç­–ç•¥**ï¼šå¦‚ä½•é©—è­‰ä¿®å¾©æœ‰æ•ˆ
6. **é é˜²æªæ–½**ï¼šå¦‚ä½•é é˜²æœªä¾†é¡ä¼¼çš„éŒ¯èª¤
7. **ç›£æ§å»ºè­°**ï¼šæœªä¾†æ‡‰ç›£æ§/è­¦å ±çš„é …ç›®
8. **åŸ·è¡Œæ‰‹å†Š**ï¼šè™•ç†é¡ä¼¼äº‹ä»¶çš„é€æ­¥æŒ‡å—

å„ªå…ˆæä¾›å¯æ“ä½œçš„å»ºè­°ï¼Œä»¥æ”¹å–„ç³»çµ±å¯é æ€§ä¸¦ç¸®çŸ­æœªä¾†äº‹ä»¶çš„ MTTRï¼ˆå¹³å‡è§£æ±ºæ™‚é–“ï¼‰ã€‚
